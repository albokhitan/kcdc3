{% extends "base.html" %}

{% block content %}

	<h1>{{ event.title }}</h1>

	<p class="date">
		<b>Date:</b> 
		{{ event.date|date:"l, j F Y" }}
	</p>
	
	<p class="byline">
		<b>Time:</b> 
		{{ event.date|date:"P" }}
		{% if event.end_time %} to {{ event.end_time|date:"P" }}{% endif %}
	</p>

	<p class="byline">
		<b>Instructor:</b>
		{% for bio in event.teacher_bios.all %}{% if not forloop.first %}, {% endif %}{{ bio.name }}{% endfor %}
	</p>

	<p class="location">
		<b>Location:</b> 
		{{ event.location }}
	</p>	
		
	{% if event.main_image %}<p><img src="/media/{{ event.main_image }}" alt="event preview image" /></p>{% endif %}
	
	{{ event.description|safe }}

	{% if event.additional_dates_text %}
		<h3>Additional meetings</h3>
		{{ event.additional_dates_text|safe }}
	{% endif %}

	<h3>Location</h3>
	<p itemprop="address" itemscope itemtype="http://data-vocabulary.org/Address">
		{% ifnotequal event.location.name event.location.address1 %}{{ event.location.name }}<br />{% endifnotequal %}
		{% if event.location.address1 and event.location.show_exact %}
			<span itemprop="street-address">
			{{ event.location.address1 }}
			{% if event.location.address2 %}<br />{{ event.location.address2 }}{% endif %}
			</span>
			<br />
		{% endif %}
		{% if event.location.city %}<span itemprop="locality">{{ event.location.city }}</span>, {% endif %}
		{% if event.location.state %}<span itemprop="region">{{ event.location.state }}</span>{% endif %}
		{% if event.location.zip %}<span itemprop="postal-code">{{ event.location.zip }}</span>{% endif %}
		{% if event.location.neighborhood %}<br />Neighborhood: {{ event.location.neighborhood }} {% endif %}
		{% if event.location.hint %}<br /><em>{{ event.location.hint }}</em>{% endif %}
	</p>
	
	{% if event.details %}
		<h3>Details</h3>
		{{ event.details|safe }}
	{% endif %}
	
	<hr />
		
	{% if not event.has_passed %}
		{% if event.registration_status == "AUTO" %}	
				<h3>Registration is not yet open.</h3>
		{% elif event.registration_status == "PREVENT" %}	
			<h3>Registration is closed.</h3>
		{% endif %}
	{% endif %}
	
	{% if registration_count >=  event.max_students %}
		{% if event.waitlist_status %}
			<p><strong>This class is full, but there is a waitlist available.</strong></p>
		{% else %}
			<p><strong>This class is full.</strong></p>
		{% endif %}
	{% endif %}
		
	{% if user_is_authenticated %}
		{% if user_is_registered %}
			<p><em>You are registered.</em></p>
			<form action="/classes/{{ event.slug }}/cancel" method="post">
				{% csrf_token %}
				<input type="submit" value="I've changed my mind. Unregister me." />
			</form>
		{% elif user_is_waitlisted %}
			<p><em>You are on the waitlist.</em></p>
			<form action="/classes/{{ event.slug }}/cancel" method="post">
				{% csrf_token %}
				<input type="submit" value="I've changed my mind. Remove me from the list." />
			</form>
		{% elif is_registration_open %}
			<form action="/classes/{{ event.slug }}/register" method="post">
				{% csrf_token %}
				{% if add_to_waitlist %}
					<input type="submit" value="Join the waitlist" />
				{% else %}
					<input type="submit" value="Register" />
				{% endif %}
			</form>
		{% endif %}
	{% else %}
		<p>
			To sign up for classes, please 
			<a href="/accounts/signin">log in</a> or 
			<a href="/accounts/signup">create a new account</a>.
		</p>
	{% endif %}
		

	{% if show_facilitator %}
		<hr />
		<p><a href="/classes/{{ event.slug }}/facilitator">view registrations</a></p>
	{% endif %}
	
{% endblock %}

